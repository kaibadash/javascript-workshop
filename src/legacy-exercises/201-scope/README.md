# 変数のスコープ
スコープは、プログラムから参照できる変数の有効範囲。
スコープは入れ子にすることが出来て、スコープの外側から内側の変数にアクセスすることは出来ない。

JavaScript では基本的に関数単位でスコープが導入される(関数スコープ)。

## ローカル変数
関数の内部で宣言した変数はローカル変数。
関数に入る時に作られ、出る時に破棄される。

## グローバル変数
トップレベル(関数の外側)で宣言した変数はグローバル変数。
グローバル変数のスコープはプログラム全体。

グローバル変数はグローバルオブジェクトのプロパティとなるので、
プログラム上のどこからでもその変数を参照できる。

例えば、`console`, `Array`, `Object`, `Math` 等はすべてグローバル変数。

## スコープチェーン
スコープをオブジェクトとして捉えてみる。

トップレベルや各関数がスコープというオブジェクト(スコープオブジェクト)を持っているとすると、
そこで宣言された変数は、スコープオブジェクトのプロパティとなる。

```js
// トップレベル (関数の外側)

var x = 1;
function f() {
  var y = 2;
  function g() {
    var z = 3;
    console.log(x); // ①
  }
}
```

例えば上の場合、`g()` では、

`{ z: 3 }` --(関数g)--> `{ y: 2, g: ... }` --(関数f)--> `{ x: 1, f: ... }` -->(トップレベル)

というチェーンをなしていると考えることができる。
これをスコープチェーンと呼ぶ。

スコープチェーンという考え方を使うと、
例えば①から変数 `x` を探す手順は次のように表現できる。

1. `{ z: 3 }` の中で見つかるか => ないので次のチェーンをたどる
2. `{ y: 2, g: ... }` の中で見つかるか => ないので次のチェーンをたどる
3. `{ x: 1, f: ... }` の中で見つかるか => 発見! `1` という値を得る

## シャドーイング
外側のスコープと同名の変数を定義すること。
```js
function f() {
  var a = 1;
  function g() {
    var a = 2;
    console.log(a); // => 内側のa? 外側のa?
  }
  g();
  console.log(a); // => ?
}
```

```js
function f() {
  var a = 1;
  function g() {
    a = 2;
    console.log(a); // => 内側のa? 外側のa?
  }
  g();
  console.log(a); // => ?
}
```
